function initTestCreate(l,a,u,s){u=u||function(a){},s=s||{};var o,i=$(a.subj),e=$(a.classes),c=$(a.books),r=$(a.themes),v="[...]";s.allClasses&&(o=$.map(s.allClasses,function(a,n){return{id:n,title:a}})).sort(function(a,n){return(+a.id||-10)-(+n.id||-10)}),i.change(function(){var a=i.val();u(!0),n(a)}),e.change(function(){var a;s.limitSubjects&&(a=e.val(),u(!0),function(t){function a(a){f[t]=a;var n=i.val();j(i,a,s.noSubj,n)}if(!t&&s.allSubjects)return a(s.allSubjects);f[t]?a(f[t]):m("/ajax/gsiCat",{class:t,retNull:1},a)}(a)),g()}),c.change(k),r.change(function(){u(!1)});var f={},d={},b={},h={};function _(a,n){var t=$("<option>");return t.val(a),t.text(n),t}function j(a,n,t,o){var i;for(var e in a.empty(),n[""]&&(t=t||n[""],a.append(_("",t))),n)if(n.hasOwnProperty(e)&&""!==e&&e!==v){var l,s,c=n[e];"string"==typeof c?l=_(s=e,n[e]):(l=_(s=c.id,c.title),c.bold&&l.css("font-weight","bold")),s===o&&(i=s),a.append(l)}a.val(i||""),u(!0)}function g(){var a=i.val(),n=e.val();s.allThemes&&j(r,s.allThemes,s.noBook),u(!0),t(a,n)}function k(){var a=c.val();u(!1),p(a)}function n(t){function a(a){d[t]=a;var n=e.val();1===Object.keys(a).length&&o?j(e,o,s.noClass,n):j(e,a,s.noClass,n),g()}d[t]?a(d[t]):m("/ajax/gsiCatClass",{retNull:1,cat:t},a)}function t(t,o){function a(a){b[t]||(b[t]={}),b[t][o]=a;var n=c.val();l.id_book&&(n=l.id_book),0===a.length?(j(c),l.id_book=null):j(c,a,s.noBook,n),k()}b[t]&&b[t][o]?a(b[t][o]):m("/ajax/gsibook",{cat:t,class:o},a)}function p(e){function a(a){h[e]=a;var n=r.val(),t=[];for(var o in l.id_theme&&(n=l.id_theme),a)if(a.hasOwnProperty(o)){var i=a[o];i.show_order?t[i.show_order]=i:t[""]=i}j(r,t,s.noTheme,n),t.length||(l.id_theme=null)}h[e]?a(h[e]):m("/ajax/gsibooksub",{book:e,retNull:1},a)}function m(a,n,t){var o=[];$.each(n,function(a,n){o.push(a+"="+n)});var i=o.join("&");iu.ajax(null,a+"?"+i,n,t)}u(!0),l.id_subject&&(n(l.id_subject),l.id_class&&t(l.id_subject,l.id_class)),l.id_book&&p(l.id_book),l.id_subject&&i.val(l.id_subject),l.id_class&&e.val(l.id_class)}
!function(k){k.fn.theiaStickySidebar=function(y){return(y=k.extend({containerSelector:"",additionalMarginTop:0,additionalMarginBottom:0,updateSidebarHeight:!0,minWidth:0},y)).additionalMarginTop=parseInt(y.additionalMarginTop)||0,y.additionalMarginBottom=parseInt(y.additionalMarginBottom)||0,k("head").append(k('<style>.theiaStickySidebar:after {content: ""; display: table; clear: both;}</style>')),this.map(function(){var i={};i.sidebar=k(this),i.options=y||{},i.container=k(i.options.containerSelector),0==i.container.size()&&(i.container=i.sidebar.parent()),i.sidebar.parents().css("-webkit-transform","none"),i.sidebar.css({position:"relative",overflow:"visible","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),i.stickySidebar=i.sidebar.find(".theiaStickySidebar"),0==i.stickySidebar.length&&(i.sidebar.find("script").remove(),i.stickySidebar=k("<div>").addClass("theiaStickySidebar").append(i.sidebar.children()),i.sidebar.append(i.stickySidebar)),i.marginTop=parseInt(i.sidebar.css("margin-top")),i.marginBottom=parseInt(i.sidebar.css("margin-bottom")),i.paddingTop=parseInt(i.sidebar.css("padding-top")),i.paddingBottom=parseInt(i.sidebar.css("padding-bottom"));var t,o,a=i.stickySidebar.offset().top,e=i.stickySidebar.outerHeight();function m(){i.fixedScrollTop=0,i.sidebar.css({"min-height":"1px"}),i.stickySidebar.css({position:"static",width:""})}return i.stickySidebar.css("padding-top",1),i.stickySidebar.css("padding-bottom",1),a-=i.stickySidebar.offset().top,e=i.stickySidebar.outerHeight()-e-a,0==a?(i.stickySidebar.css("padding-top",0),i.stickySidebarPaddingTop=0):i.stickySidebarPaddingTop=1,0==e?(i.stickySidebar.css("padding-bottom",0),i.stickySidebarPaddingBottom=0):i.stickySidebarPaddingBottom=1,i.previousScrollTop=null,i.fixedScrollTop=0,i.paddingHack=0,m(),i.onScroll=function(i){if(i.stickySidebar.is(":visible"))if(k("body").width()<i.options.minWidth)m();else if(i.sidebar.outerWidth(!0)+50>i.container.width())m();else{var t,o,a=k(document).scrollTop(),e="static";if(a-i.paddingHack>=i.container.offset().top+(i.paddingTop+i.marginTop-i.options.additionalMarginTop)){var d,s=i.paddingTop+i.marginTop+y.additionalMarginTop,r=i.paddingBottom+i.marginBottom+y.additionalMarginBottom,n=i.container.offset().top,c=i.container.offset().top+(t=i.container,o=t.height(),t.children().each(function(){o=Math.max(o,k(this).height())}),o),p=0+y.additionalMarginTop;d=i.stickySidebar.outerHeight()+s+r<k(window).height()?p+i.stickySidebar.outerHeight():k(window).height()-i.marginBottom-i.paddingBottom-y.additionalMarginBottom;var b=n-a+i.paddingTop+i.marginTop,g=c-a-i.paddingBottom-i.marginBottom,l=i.stickySidebar.offset().top-a,S=i.previousScrollTop-a;"fixed"==i.stickySidebar.css("position")&&(l+=S),l=0<S?Math.min(l,p):Math.max(l,d-i.stickySidebar.outerHeight()),l=Math.max(l,b),l=Math.min(l,g-i.stickySidebar.outerHeight());var h=i.container.height()==i.stickySidebar.outerHeight();e=(h||l!=p)&&(h||l!=d-i.stickySidebar.outerHeight())?a+l-i.sidebar.offset().top-i.paddingTop<=y.additionalMarginTop?"static":"absolute":"fixed"}if("fixed"==e)i.stickySidebar.css({position:"fixed",width:i.sidebar.width(),top:l,left:i.sidebar.offset().left+parseInt(i.sidebar.css("padding-left"))});else if("absolute"==e){var f={};"absolute"!=i.stickySidebar.css("position")&&(f.position="absolute",f.top=a+l-i.sidebar.offset().top-i.stickySidebarPaddingTop-i.stickySidebarPaddingBottom),f.width=i.sidebar.width(),f.left="",i.stickySidebar.css(f)}else"static"==e&&m();"static"!=e&&1==i.options.updateSidebarHeight&&i.sidebar.css({"min-height":i.stickySidebar.outerHeight()+i.stickySidebar.offset().top-i.sidebar.offset().top+i.paddingBottom}),i.previousScrollTop=a}},i.onScroll(i),k(document).scroll((t=i,function(){t.onScroll(t)})),k(window).resize((o=i,function(){o.stickySidebar.css({position:"static"}),o.onScroll(o)})),i})}}(jQuery);